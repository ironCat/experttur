---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";

const articles = await getCollection("articles");
const countries = await getCollection("countries");
const directions = await getCollection("directions");
const partners = await getCollection("partners");

const latestArticles = [...articles]
  .sort((a, b) => (b.data.publishedAt || "").localeCompare(a.data.publishedAt || ""))
  .slice(0, 3);

const topCountry = countries[0];
const heroPartner = partners.find((p) => p.data.position === "home_hero");
---

<Layout>
	<div class="mx-auto flex max-w-6xl flex-col gap-10 px-4 py-8">
		<section class="grid gap-8 md:grid-cols-[minmax(0,2fr)_minmax(0,1.2fr)] items-start">
			<div class="space-y-4">
				<p class="text-xs uppercase tracking-[0.18em] text-[hsl(var(--muted-foreground))]">
					Travel inspiration
				</p>
				<h1 class="text-4xl font-semibold leading-tight">
					Discover curated trips for US & European travelers.
				</h1>
				<p class="max-w-xl text-sm text-[hsl(var(--muted-foreground))]">
					Browse destinations, country guides and deep-dive stories tailored for visitors
					from the United States, Germany, Netherlands and Finland.
				</p>
				<form class="mt-4 flex flex-col gap-3 sm:flex-row">
					<input
						class="h-10 flex-1 rounded-full border border-[hsl(var(--border))] bg-[hsl(var(--background))] px-4 text-sm outline-none focus-visible:ring-2 focus-visible:ring-[hsl(var(--ring))]"
						placeholder="Search articles by city, country or theme"
						type="search"
					/>
					<button class="h-10 rounded-full bg-[hsl(var(--primary))] px-5 text-sm font-medium text-[hsl(var(--primary-foreground))] hover:bg-[hsl(var(--primary)/0.9)]">
						Search
					</button>
				</form>
			</div>

			<div class="space-y-3 rounded-3xl bg-[hsl(var(--muted))] p-5">
				{topCountry && (
					<div class="space-y-2">
						<p class="text-xs font-medium uppercase tracking-wide text-[hsl(var(--muted-foreground))]">
							Top pick this week
						</p>
						<h2 class="text-lg font-semibold">{topCountry.data.name}</h2>
						<p class="text-sm text-[hsl(var(--muted-foreground))]">
							{topCountry.data.description}
						</p>
					</div>
				)}

				{heroPartner && (
					<div class="mt-4 space-y-1 rounded-2xl bg-[hsl(var(--background))] p-3 text-xs text-[hsl(var(--muted-foreground))]">
						<p class="text-[0.65rem] font-semibold uppercase tracking-[0.18em] text-[hsl(var(--muted-foreground))]">
							Partner highlight
						</p>
						<p class="text-sm font-medium text-[hsl(var(--foreground))]">{heroPartner.data.title}</p>
						<p>Partner snippet will be rendered here.</p>
					</div>
				)}
			</div>
		</section>

		<section class="space-y-4">
			<header class="flex items-center justify-between">
				<h2 class="text-xl font-semibold tracking-tight">Latest stories</h2>
				<a href="#" class="text-xs font-medium text-[hsl(var(--muted-foreground))]">
					View all
				</a>
			</header>
			<div class="grid gap-4 md:grid-cols-3">
				{latestArticles.map((article) => (
					<a
						href={`/content/${article.data.slug ?? article.slug}`}
						class="group flex flex-col gap-2 rounded-2xl border border-[hsl(var(--border))] bg-[hsl(var(--background))] p-4 text-sm hover:shadow-md"
					>
						<p class="text-[0.7rem] font-medium uppercase tracking-[0.18em] text-[hsl(var(--muted-foreground))]">
							{article.data.country}
						</p>
						<h3 class="line-clamp-2 text-sm font-semibold leading-snug group-hover:underline">
							{article.data.title}
						</h3>
						{article.data.excerpt && (
							<p class="line-clamp-3 text-xs text-[hsl(var(--muted-foreground))]">
								{article.data.excerpt}
							</p>
						)}
					</a>
				))}
			</div>
		</section>
	</div>
</Layout>
